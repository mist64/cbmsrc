.PAG 'CODE10'
;TEST POINTER TO VARIABLE TO SEE
;IF CONSTANT IS CONTAINED IN BASIC.
;ARRAY VARIABLES HAVE ZEROES PLACED
;IN RAM. UNDEFINED SIMPLE VARIABLES
;HAVE POINTER T ZERO IN BASIC.
;
TSTROM	SEC
	LDA FACMO
	SBC #<ROMLOC
	LDA FACLO
	SBC #>ROMLOC
	BCC TSTR10
;
	LDA #<INITAT
	SBC FACMO
	LDA #>INITAT
	SBC FACLO
;
TSTR10	RTS
.SKI 5
ISVAR	JSR PTRGET
ISVRET	STA FACMO
	STY FACMO+1
	LDX VARNAM
	LDY VARNAM+1
	LDA VALTYP
	BEQ GOOO
	LDA #0
	STA FACOV
	JSR TSTROM      ;SEE IF AN ARRAY
	BCC STRRTS      ;DON'T TEST ST(I),TI(I)
	CPX #'T
	BNE STRRTS
	CPY #$C9
	BNE STRRTS
	JSR GETTIM
	STY TENEXP
	DEY
	STY FBUFPT
	LDY #6
	STY DECCNT
	LDY #FDCEND-FOUTBL
	JSR FOUTIM
	JMP TIMSTR
STRRTS	RTS
GOOO	BIT INTFLG
	BPL GOOOOO
	LDY #0
	LDA (FACMO)Y
	TAX
	INY
	LDA (FACMO)Y
	TAY
	TXA
	JMP GIVAYF
GOOOOO	JSR TSTROM      ;SEE IF ARRAY
	BCC GOMOVF      ;DON'T TEST ST(I),TI(I)
	CPX #'T
	BNE QSTATV
	CPY #'I
	BNE GOMOVF
	JSR GETTIM
	TYA
	LDX #160
	JMP FLOATB
GETTIM	JSR RDTIM
	STX FACMO
	STY FACMOH
	STA FACLO
	LDY #0
	STY FACHO
	RTS
QSTATV	CPX #'S
	BNE GOMOVF
	CPY #'T
	BNE GOMOVF
	JSR READST
	JMP FLOAT
GOMOVF	LDA FACMO
	LDY FACMO+1
	JMP MOVFM
ISFUN	ASL A
	PHA
	TAX
	JSR CHRGET
	CPX #LASNUM+LASNUM-255
	BCC OKNORM
	JSR CHKOPN
	JSR FRMEVL
	JSR CHKCOM
	JSR CHKSTR
	PLA
	TAX
	LDA FACMO+1
	PHA
	LDA FACMO
	PHA
	TXA
	PHA
	JSR GETBYT
	PLA
	TAY
	TXA
	PHA
	JMP FINGO
OKNORM	JSR PARCHK
	PLA
	TAY
FINGO	LDA FUNDSP-ONEFUN-ONEFUN+256,Y
	STA JMPER+1
	LDA FUNDSP-ONEFUN-ONEFUN+257,Y
	STA JMPER+2
	JSR JMPER
	JMP CHKNUM
OROP	LDY #255
	.BYT $2C
ANDOP	LDY #0
	STY COUNT
	JSR AYINT
	LDA FACMO
	EOR COUNT
	STA INTEGR
	LDA FACLO
	EOR COUNT
	STA INTEGR+1
	JSR MOVFA
	JSR AYINT
	LDA FACLO
	EOR COUNT
	AND INTEGR+1
	EOR COUNT
	TAY
	LDA FACMO
	EOR COUNT
	AND INTEGR
	EOR COUNT
	JMP GIVAYF
DOREL	JSR CHKVAL
	BCS STRCMP
	LDA ARGSGN
	ORA #127
	AND ARGHO
	STA ARGHO
	LDA #<ARGEXP
	LDY #>ARGEXP
	JSR FCOMP
	TAX
	JMP QCOMP
STRCMP	LDA #0
	STA VALTYP
	DEC OPMASK
	JSR FREFAC
	STA DSCTMP
	STX DSCTMP+1
	STY DSCTMP+2
	LDA ARGMO
	LDY ARGMO+1
	JSR FRETMP
	STX ARGMO
	STY ARGMO+1
	TAX
	SEC
	SBC DSCTMP
	BEQ STASGN
	LDA #1
	BCC STASGN
	LDX DSCTMP
	LDA #$FF
STASGN	STA FACSGN
	LDY #255
	INX
NXTCMP	INY
	DEX
	BNE GETCMP
	LDX FACSGN
QCOMP	BMI DOCMP
	CLC
	BCC DOCMP
GETCMP	LDA (ARGMO)Y
.END
