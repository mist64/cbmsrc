.PAG 'CODE14'
	PHA
	LDA TXTPTR
	PHA
	JSR DATA
	JMP DEFFIN
GETFNM	LDA #FNTK
	JSR SYNCHR
	ORA #128
	STA SUBFLG
	JSR PTRGT2
	STA DEFPNT
	STY DEFPNT+1
	JMP CHKNUM
FNDOER	JSR GETFNM
	LDA DEFPNT+1
	PHA
	LDA DEFPNT
	PHA
	JSR PARCHK
	JSR CHKNUM
	PLA
	STA DEFPNT
	PLA
	STA DEFPNT+1
	LDY #2
	LDA (DEFPNT)Y
	STA VARPNT
	TAX
	INY
	LDA (DEFPNT)Y
	BEQ ERRGUF
	STA VARPNT+1
	INY
DEFSTF	LDA (VARPNT)Y
	PHA
	DEY
	BPL DEFSTF
	LDY VARPNT+1
	JSR MOVMF
	LDA TXTPTR+1
	PHA
	LDA TXTPTR
	PHA
	LDA (DEFPNT)Y
	STA TXTPTR
	INY
	LDA (DEFPNT)Y
	STA TXTPTR+1
	LDA VARPNT+1
	PHA
	LDA VARPNT
	PHA
	JSR FRMNUM
	PLA
	STA DEFPNT
	PLA
	STA DEFPNT+1
	JSR CHRGOT
	BEQ *+5
	JMP SNERR
	PLA
	STA TXTPTR
	PLA
	STA TXTPTR+1
DEFFIN	LDY #0
	PLA
	STA (DEFPNT)Y
	PLA
	INY
	STA (DEFPNT)Y
	PLA
	INY
	STA (DEFPNT)Y
	PLA
	INY
	STA (DEFPNT)Y
	PLA
	INY
	STA (DEFPNT)Y
	RTS
STRD	JSR CHKNUM
	LDY #0
	JSR FOUTC
	PLA
	PLA
TIMSTR	LDA #<LOFBUF
	LDY #>LOFBUF
	BEQ STRLIT
STRINI	LDX FACMO
	LDY FACMO+1
	STX DSCPNT
	STY DSCPNT+1
STRSPA	JSR GETSPA
	STX DSCTMP+1
	STY DSCTMP+2
	STA DSCTMP
	RTS
STRLIT	LDX #34
	STX CHARAC
	STX ENDCHR
STRLT2	STA STRNG1
	STY STRNG1+1
	STA DSCTMP+1
	STY DSCTMP+2
	LDY #255
STRGET	INY
	LDA (STRNG1)Y
	BEQ STRFI1
	CMP CHARAC
	BEQ STRFIN
	CMP ENDCHR
	BNE STRGET
STRFIN	CMP #34
	BEQ STRFI2
STRFI1	CLC
STRFI2	STY DSCTMP
	TYA
	ADC STRNG1
	STA STRNG2
	LDX STRNG1+1
	BCC STRST2
	INX
STRST2	STX STRNG2+1
	LDA STRNG1+1
	BEQ STRCP
	CMP #BUFPAG
	BNE PUTNEW
STRCP	TYA
	JSR STRINI
	LDX STRNG1
	LDY STRNG1+1
	JSR MOVSTR
PUTNEW	LDX TEMPPT
	CPX #TEMPST+STRSIZ+STRSIZ+STRSIZ
	BNE PUTNW1
	LDX #ERRST
ERRGO2	JMP ERROR
PUTNW1	LDA DSCTMP
	STA 0,X
	LDA DSCTMP+1
	STA 1,X
	LDA DSCTMP+2
	STA 2,X
	LDY #0
	STX FACMO
	STY FACMO+1
	STY FACOV
	DEY
	STY VALTYP
	STX LASTPT
	INX
	INX
	INX
	STX TEMPPT
	RTS
GETSPA	LSR GARBFL
TRYAG2	PHA
	EOR #255
	SEC
	ADC FRETOP
	LDY FRETOP+1
	BCS TRYAG3
	DEY
TRYAG3	CPY STREND+1
	BCC GARBAG
	BNE STRFRE
	CMP STREND
	BCC GARBAG
STRFRE	STA FRETOP
	STY FRETOP+1
	STA FRESPC
	STY FRESPC+1
	TAX
	PLA
	RTS
GARBAG	LDX #ERROM
	LDA GARBFL
	BMI ERRGO2
	JSR GARBA2
	LDA #128
	STA GARBFL
	PLA
	BNE TRYAG2
GARBA2	LDX MEMSIZ
	LDA MEMSIZ+1
FNDVAR	STX FRETOP
	STA FRETOP+1
	LDY #0
	STY GRBPNT+1
	STY GRBPNT
	LDA STREND
	LDX STREND+1
	STA GRBTOP
	STX GRBTOP+1
	LDA #<TEMPST
	LDX #>TEMPST
	STA INDEX1
	STX INDEX1+1
TVAR	CMP TEMPPT
	BEQ SVARS
	JSR DVAR
	BEQ TVAR
SVARS	LDA #6+ADDPRC
	STA FOUR6
	LDA VARTAB
	LDX VARTAB+1
.END
